# Scalafmt configuration
version = 3.8.3

# Runner settings
runner.dialect = scala3

# Basic formatting
maxColumn = 100
assumeStandardLibraryStripMargin = true
docstrings.style = Asterisk

# Indentation
indent.main = 2
indent.significant = 2
indent.callSite = 2
indent.ctrlSite = 2
indent.defnSite = 2
indent.caseSite = 2
indent.extendSite = 2
indent.withSiteRelativeToExtends = 2

# Alignment
align.preset = more
align.multiline = true
align.tokens."+" = [
  {code = "=>", owner = "Case"},
  {code = "=", owner = "(Enumerator.Val|Defn.(Va(l|r)|Def|Type))"},
  {code = "<-", owner = "Enumerator.Generator"},
  {code = "//", owner = ".*"},
  {code = "{", owner = "Template"},
  {code = "}", owner = "Template"},
  {code = "%", owner = "Term.ApplyInfix"},
  {code = "%%", owner = "Term.ApplyInfix"}
]

# Newlines
newlines.beforeCurlyLambdaParams = multilineWithCaseOnly
newlines.afterCurlyLambdaParams = squash
newlines.implicitParamListModifierPrefer = before
newlines.sometimesBeforeColonInMethodReturnType = false
newlines.topLevelStatementBlankLines = [
  {blanks = 1}
]

# Rewrite rules
rewrite.rules = [
  RedundantBraces,
  RedundantParens,
  SortModifiers,
  PreferCurlyFors,
  Imports
]

rewrite.redundantBraces.maxLines = 1
rewrite.redundantBraces.stringInterpolation = true
rewrite.redundantBraces.generalExpressions = true

rewrite.imports.sort = scalastyle
rewrite.imports.groups = [
  ["java\\..*"],
  ["scala\\..*"],
  [".*"]
]

rewrite.scala3.convertToNewSyntax = true
rewrite.scala3.removeOptionalBraces = no
rewrite.scala3.insertEndMarkerMinLines = 15

# Trailing commas (useful for version control)
trailingCommas = multiple

# Vertical alignment
verticalMultiline.atDefnSite = true
verticalMultiline.arityThreshold = 4
verticalMultiline.newlineAfterOpenParen = true

# Spaces
spaces.inImportCurlyBraces = false
spaces.beforeContextBoundColon = Always

# Comments
comments.wrap = standalone
comments.wrapStandaloneSlcAsSlc = true

# Literals
literals.long = Upper
literals.float = Upper
literals.double = Upper

# Line endings
lineEndings = unix

# Project-specific settings
project.git = true
project.excludeFilters = [
  "target/"
]

# Optional: More aggressive for Scala 3
rewrite.trailingCommas.style = multiple
rewrite.scala3.removeEndMarkerMaxLines = 0